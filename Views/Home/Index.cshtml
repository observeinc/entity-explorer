@using Observe.EntityExplorer.DataObjects;

@model Observe.EntityExplorer.Models.BaseViewModel;

@{
    ViewData["Title"] = "Home";
}

<p>
    <span class="spanError">@ViewData["ErrorMessage"]</span>
</p>
@if (ViewData["ErrorMessage"] != null)
{
    return;
}

<h1>Connect</h1>
<p>
    <a asp-area="" asp-controller="Connection" asp-action="Connect">🔑 Connect</a> with different credentials or log out
<p>

<h1>Explore</h1>

@using (Html.BeginForm("Index", "Home", new {userid=Model.CurrentUser.UniqueID}, FormMethod.Post))
{
    <table>
        <tr>
            <td>Location</td>
            <td>
                <a href="@Model.ObserveEnvironment.CustomerEnvironmentUrl">@Model.ObserveEnvironment.CustomerEnvironmentUrl</a>
                @Model.ObserveEnvironment.CustomerLabel (@Model.ObserveEnvironment.CustomerName) in @Model.ObserveEnvironment.Deployment
            </td>
        </tr>
        <tr>
            <td>Loaded On</td>
            <td>
                @Model.ObserveEnvironment.LoadedOn.ToString("u") <button type="submit" id="buttonRefresh" name="buttonRefresh" value="Refresh">Refresh</button>
            </td>
        </tr>
        <tr>
    </table>
}

<table>
    <tr>
        <th>Category</th>
        <th>Statistics</th>
        <th>Costs</th>
        <th>Actions</th>
    </tr>
    <tr>
        <td>Datasets</td>
        <td>
            <table>
                <thead>
                    <th>Category</th>
                    <th>Number</th>
                </thead>
                <tr>
                    <td>Total</td>
                    <td>@Model.ObserveEnvironment.GetObjectsOfType(ObsCompositeObjectType.Dataset).Count</td>
                </tr>
                <tr>
                    <td>Event</td>
                    <td>@Model.ObserveEnvironment.GetObjectsOfType(ObsCompositeObjectType.EventDataset).Count</td>
                </tr>
                <tr>
                    <td>Interval</td>
                    <td>@Model.ObserveEnvironment.GetObjectsOfType(ObsCompositeObjectType.IntervalDataset).Count</td>
                </tr>
                <tr>
                    <td>Resource</td>
                    <td>@Model.ObserveEnvironment.GetObjectsOfType(ObsCompositeObjectType.ResourceDataset).Count</td>
                </tr>
                <tr>
                    <td>DatastreamDataset</td>
                    <td>@Model.ObserveEnvironment.GetObjectsOfType(ObsCompositeObjectType.DatastreamDataset).Count</td>
                </tr>
                <tr>
                    <td>MetricSMADataset</td>
                    <td>@Model.ObserveEnvironment.GetObjectsOfType(ObsCompositeObjectType.MetricSMADataset).Count</td>
                </tr>
                <tr>
                    <td>MonitorSupportDataset</td>
                    <td>@Model.ObserveEnvironment.GetObjectsOfType(ObsCompositeObjectType.MonitorSupportDataset).Count</td>
                </tr>
                <tr>
                    <td>InterfaceMetricDataset</td>
                    <td>@Model.ObserveEnvironment.GetObjectsOfType(ObsCompositeObjectType.InterfaceMetricDataset).Count</td>
                </tr>
                <tr>
                    <td>InterfaceLogDataset</td>
                    <td>@Model.ObserveEnvironment.GetObjectsOfType(ObsCompositeObjectType.InterfaceLogDataset).Count</td>
                </tr>
            </table>
        </td>
        <td>
            <table>
                <thead>
                    <th>Length</th>
                    <th>Transform</th>
                    <th>Query</th>
                </thead>
                <tr>
                    <td>1 hour</td>
                    <td>@Model.ObserveEnvironment.AllDatasetsDict.Values.ToList().Sum(d => d.Transform1H.Credits).ToString("##0.#")</td>
                    <td>@Model.ObserveEnvironment.AllDatasetsDict.Values.ToList().Sum(d => d.Query1H.Credits).ToString("#.#")</td>
                </tr>
                <tr>
                    <td>1 day</td>
                    <td>@Model.ObserveEnvironment.AllDatasetsDict.Values.ToList().Sum(d => d.Transform1D.Credits).ToString("##0.#")</td>
                    <td>@Model.ObserveEnvironment.AllDatasetsDict.Values.ToList().Sum(d => d.Query1D.Credits).ToString("#.#")</td>
                </tr>
                <tr>
                    <td>1 week</td>
                    <td>@Model.ObserveEnvironment.AllDatasetsDict.Values.ToList().Sum(d => d.Transform1W.Credits).ToString("##0.#")</td>
                    <td>@Model.ObserveEnvironment.AllDatasetsDict.Values.ToList().Sum(d => d.Query1W.Credits).ToString("#.#")</td>
                </tr>
            </table>
        </td>
        <td><a asp-area="" asp-controller="Select" asp-action="Dataset" asp-route-userid="@Model.CurrentUser.UniqueID">🎫 Explore Datasets</a> - Review the structure and dependencies of datasets</td>
    </tr>
    <tr>
        <td>Dashboards</td>
        <td>@Model.ObserveEnvironment.GetObjectsOfType(ObsCompositeObjectType.Dashboard).Count</td>
        <td></td>
        <td><a asp-area="" asp-controller="Select" asp-action="Dashboard" asp-route-userid="@Model.CurrentUser.UniqueID">📈 Explore Dashboards</a> - Review the structure and dependencies of custom and app dashboards</td>
    </tr>
    <tr>
        <td>Worksheets</td>
        <td></td>
        <td></td>
        <td><a asp-area="" asp-controller="Select" asp-action="Worksheet" asp-route-userid="@Model.CurrentUser.UniqueID">📝 Explore Worksheets</a> - Review the structure of ad-hoc worksheets</td>
    </tr>
    <tr>
        <td>Monitors</td>
        <td>
            <table>
                <thead>
                    <th>Category</th>
                    <th>Number</th>
                </thead>
                <tr>
                    <td>Total</td>
                    <td>@Model.ObserveEnvironment.GetObjectsOfType(ObsCompositeObjectType.Monitor).Count</td>
                </tr>
                <tr>
                    <td>Metric Threshold</td>
                    <td>@Model.ObserveEnvironment.GetObjectsOfType(ObsCompositeObjectType.MetricThresholdMonitor).Count</td>
                </tr>
                <tr>
                    <td>Log Threshold</td>
                    <td>@Model.ObserveEnvironment.GetObjectsOfType(ObsCompositeObjectType.LogThresholdMonitor).Count</td>
                </tr>
                <tr>
                    <td>Resource Count</td>
                    <td>@Model.ObserveEnvironment.GetObjectsOfType(ObsCompositeObjectType.ResourceCountThresholdMonitor).Count</td>
                </tr>
                <tr>
                    <td>Promotion</td>
                    <td>@Model.ObserveEnvironment.GetObjectsOfType(ObsCompositeObjectType.PromotionMonitor).Count</td>
                </tr>
                <tr>
                    <td>Text</td>
                    <td>@Model.ObserveEnvironment.GetObjectsOfType(ObsCompositeObjectType.ResourceTextValueMonitor).Count</td>
                </tr>
            </table>
        </td>
        <td>
            <table>
                <thead>
                    <th>Length</th>
                    <th>Transform</th>
                </thead>
                <tr>
                    <td>1 hour</td>
                    <td>@Model.ObserveEnvironment.AllMonitorsDict.Values.ToList().Sum(d => d.Transform1H.Credits).ToString("##0.#")</td>
                </tr>
                <tr>
                    <td>1 day</td>
                    <td>@Model.ObserveEnvironment.AllMonitorsDict.Values.ToList().Sum(d => d.Transform1D.Credits).ToString("##0.#")</td>
                </tr>
                <tr>
                    <td>1 week</td>
                    <td>@Model.ObserveEnvironment.AllMonitorsDict.Values.ToList().Sum(d => d.Transform1W.Credits).ToString("##0.#")</td>
                </tr>
            </table>
        </td>
        <td><a asp-area="" asp-controller="Select" asp-action="Monitor" asp-route-userid="@Model.CurrentUser.UniqueID">📟 Explore Monitors</a> - Review the monitor configuration and dataset dependencies</td>
    </tr>
@{
    ObsObject syntheticNonExistentObject = new ObsObject();
    syntheticNonExistentObject.id = "-1";
    syntheticNonExistentObject.name = "All Objects";
}
    <tr>
        <td>All Relationships</td>
        <td><button id="buttonVisualize_RelatedObjectsGraph" onclick="goToGraphVizOnline('textArea_RelatedObjectsGraph')">🔭 View</button></td>
        <td></td>
        <td>
            <textarea id="textArea_RelatedObjectsGraph" style="width:400px;height:200px;">@Model.ObserveEnvironment.RenderGraphOfRelationships(syntheticNonExistentObject, @Model.ObserveEnvironment.ObjectRelationships)</textarea>
        </td>
    </tr>
    @* <tr>
        <td>All Data</td>
        <td>Export to Excel </td>
        <td>
@using (Html.BeginForm("Index", "Home", FormMethod.Post))
{
    <button type="submit" id="buttonExportToExcel" name="buttonExportToExcel" value="Export to Excel">Export All to Excel <img src="https://cdn-dynmedia-1.microsoft.com/is/image/microsoftcorp/Icon_Excel_2x_RE2Xztz?resMode=sharp2&op_usm=1.5,0.65,15,0&wid=64&hei=64&qlt=99&fit=constrain" /></button>
}
        </td>
    </tr> *@
</table>

<script src="~/js/DetailsCommon.js" asp-append-version="true"></script>